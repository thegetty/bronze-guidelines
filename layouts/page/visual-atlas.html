{{/*
  Essay layout. This layout describes a single-page template that has been
  augmented with the ability to display a frontmatter-defined abstract (in
  markdown format) as well as bibliography references.
*/}}

{{ define "main" }}
<article class="{{ partial "page-class.html" . }} quire-essay" id="main" role="main">
  {{ partial "page-header.html" . }}

  <section id="content" class="section quire-page__content">
    {{ if .Params.abstract }}
    {{ partial "page-abstract.html" . }}
    {{ end }}
    <div class="container">
      <div class="content">
        {{ .Content }}

        {{ range .Site.Data.figures.figure_list }}

        {{- $alt := "" -}}
        {{- $aspectRatio := "" -}}
        {{- $caption := "" -}}
        {{- $credit := "" -}}
        {{- $download := "" -}}
        {{- $id := "" -}}
        {{- $label := "" -}}
        {{- $mediaId := "" -}}
        {{- $mediaType := "" -}}
        {{- $src := "" -}}

        {{- with .alt }}{{ $alt = . }}{{ end -}}
        {{- with .aspect_ratio }}{{ $aspectRatio = . }}{{ end -}}
        {{- with .caption }}{{ $caption = . }}{{ end -}}
        {{- with .credit }}{{ $credit = . }}{{ end -}}
        {{- with .download }}{{ $download = . }}{{ end -}}
        {{- with .id }}{{ $id = . }}{{ end -}}
        {{- with .label }}{{ $label = . }}{{ end -}}
        {{- with .media_id }}{{ $mediaId = . }}{{ end -}}
        {{- with .media_type }}{{ $mediaType = . }}{{ end -}}
        {{- with .src }}{{ $src = . }}{{ end -}}

        {{- $dict := dict "Site" $.Site "alt" $alt "aspectRatio" $aspectRatio "caption" $caption "credit" $credit "download" $download "id" $id "label" $label "mediaId" $mediaId "mediaType" $mediaType "src" $src -}}

        <figure
          data="q-figure"
          class="quire-figure"
          id="{{ $id }}"
        >
          <div class="q-figure__wrapper">
            {{ if eq $mediaType "youtube" -}}
              {{- partial "figures/media-types/youtube.html" $dict -}}
            {{- else if eq $mediaType "vimeo" -}}
              {{- partial "figures/media-types/vimeo.html" $dict -}}
            {{- else if eq $mediaType "soundcloud" -}}
              {{- partial "figures/media-types/soundcloud.html" $dict -}}
            {{- else if eq $mediaType "website" -}}
              {{- partial "figures/media-types/website.html" $dict -}}
            {{- else if eq $mediaType "table" -}}
              {{- partial "figures/media-types/table.html" $dict -}}
            {{- else -}}
              {{- partial "figures/media-types/image.html" $dict -}}
            {{- end -}}
          </div>
        </figure>

        {{ end }}

      </div>
      {{ partial "footer-buttons.html" . }}
    </div>
  </section>
</article>
{{ end }}